# Maintainer:  Federico Cinelli <cinelli.federico@gmail.com>
# Contributor: Egor Pomortsev <egor.pomortsev@gmail.com>
# Contributor: M Rawash <mrawash@gmail.com>
# Contributor: Andrzej Giniewicz <gginiu@gmail.com>

pkgname=xf86-input-wacom-git
pkgver=0.25.0+2
pkgrel=1
pkgdesc="X.Org Wacom tablet driver (from git)"
url="https://github.com/jigpu/xf86-input-wacom"
arch=(i686 x86_64)
license=(GPL)
depends=(libxi libxinerama libxrandr)
makedepends=(autoconf automake git xorg-server-devel libxext xorg-util-macros)
provides=("xf86-input-wacom=$pkgver")
conflicts=(xf86-input-wacom)
options=(!libtool)
backup=(etc/X11/xorg.conf.d/50-wacom.conf)

source=("git://git.code.sf.net/p/linuxwacom/xf86-input-wacom"
        "touch_nonfatal.patch"
        )
md5sums=('SKIP'
         'SKIP'
         )

pkgver() {
  cd xf86-input-wacom
  git describe | sed -r 's/^xf86-input-wacom-([^-]+)-([0-9]+)-g.*$/\1+\2/'
}

prepare() {
  mkdir xf86-input-wacom/m4
}

build() {
  cd xf86-input-wacom
  patch -p1 < ../touch_nonfatal.patch
  grep "ignoring" tools/tools-shared.c
  ./autogen.sh --prefix=/usr --with-xorg-conf-dir=/etc/X11/xorg.conf.d
  make
}

check() {
  cd xf86-input-wacom
  make -k check || :
}

package() {
  cd xf86-input-wacom
  make DESTDIR="$pkgdir" install
}

