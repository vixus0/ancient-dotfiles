#!/bin/bash
# vim: set fileencoding=utf-8 ts=4 sts=4 sw=4 tw=80 expandtab :

# Copyright (C) 2012 Florian Bruhin <me@the-compiler.org>

# onboardctl is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
# 
# onboardctl is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with onboardctl  If not, see <http://www.gnu.org/licenses/>.


# Sets the hlwm-padding and launches onboard
launch() {
    currot=$(xrandr --verbose -q -o normal --dryrun | \
             sed -n 's/^Current rotation - //p')
    case $currot in
        normal|reverse) x=18; y=468;  w=1006; h=300 ;;
        left|right)     x=0; y=1066; w=768;  h=300 ;;
    esac
    [[ $1 == onlypad ]] || onboard -x "$x" -y "$y" -s "${w}x${h}" &
    pad "$h" &
}

# Gets the current onboard-state
isrunning() { pgrep '^onboard$' &>/dev/null ;}

# Toggles the onboard-state (shown/hidden)
toggle() { isrunning && hide || launch ;}

# Kills onboard if it is running
hide() { isrunning && killall onboard && herbstclient pad 0 "" "" 0 "" ;}

# Sets the herbstluftwm padding
pad() { herbstclient pad 0 "" "" "$1" "" ;}

# Handles screen rotation
rotate() { isrunning && launch onlypad ;}

case $1 in
    hide|kill) hide ;;
    launch|show|launchshow) launch ;;
    state) isrunning ;;
    toggle) toggle ;;
    rotate) sleep 0.1; rotate ;;
esac

