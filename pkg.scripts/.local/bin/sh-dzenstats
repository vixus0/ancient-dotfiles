#!/bin/bash

##
# Simple dzen-based applets
##

## COLORS
color0='#1e2d33'
color1='#802828'
color2='#909737'
color3='#b27d12'
color4='#1e5673'
color5='#642337'
color6='#196271'
color7='#99b3bd'
color9='#334d57'
color8='#8a3232'

dzen_applet() {
  dzen2 -l $1 -tw 16 -w $2 -sa c -x 0 -y $3 -e 'entertitle=uncollapse;leavetitle=collapse' ${@:4} 
}

clock_stat() {
  echo -e "^tw()^fg($color4)\u2b96\n^cs()\n"
  date +"^fg($color2)%H:%M"
  date +"^fg($color2)%d %B %Y"
  echo
  cal | tail -n+2 | sed "s/\b$(date +%-d)\b/^fg($color2)&^fg()/g"
}

batt_stat() {
  tokens=( `acpi --battery` )
  mode=${tokens[2]%%,*}
  perc=${tokens[3]%%\%*}
  timeleft=${tokens[4]}
  outp="^fg($color2)\u2b8f"

  [[ $perc -lt 20 ]] && outp="^fg($color1)\u2b91"
  echo -e "^tw()$outp\n^cs()\n"
  echo $mode
  echo $perc | gdbar -bg $color0 -fg $color4 -h 1
  echo $timeleft
  echo
}

wifi_stat() {
  dat="`wicd-cli -y -d`"
  clr="$color3"
  [[ "$dat" == *Invalid* ]] && clr="$color0"
  echo -e "^tw()^fg($clr)\u2bb7\n^cs()\n"
  wicd-cli -y -d | head -n 2
  echo
}

fav_menu() {
  echo -e "^fg($color1)^ca(1,/home/vixus/scripts/favdzen)\u2ba0^ca()"
}

while_sleep() {
  while true; do
    $2
    sleep $1
  done
}

while_sleep 30s clock_stat | dzen_applet 11 120 2 &
while_sleep 1m batt_stat | dzen_applet 5 120 22 &
( [[ -e /usr/bin/wicd-cli ]] && while_sleep 5s wifi_stat | dzen_applet 4 120 42 ) &
fav_menu | dzen_applet 0 120 62 -p &

