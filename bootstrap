#!/bin/bash
#   _                                        
#  | |                                       
#  | |   __   __ _|_  , _|_  ,_    __,    _  
#  |/ \_/  \_/  \_|  / \_|  /  |  /  |  |/ \_
#   \_/ \__/ \__/ |_/ \/ |_/   |_/\_/|_/|__/ 
#                                      /|    
#  Doing the work so I don't have to.  \|    
#  


# Headless packages
cpackages=(\
  "git"
  "bash-completion"
  "openssh"
  "stow"
  "vim"
  "tmux"
  )


# GUI packages
xpackages=(\
  "xorg-server"
  "xorg-xrdb"
  "xorg-setxkbmap"
  "xorg-xset"
  "xorg-xmodmap"
  "herbstluftwm"
  "xcompmgr"
  "firefox"
  "adobe-source-code-pro-fonts"
  "sxiv"
  "nitrogen"
  "mpv"
  "conky"
  )


# AUR packages
apackages=(\
  "termite-git"
  "sxhkd"
  )


# Set cwd to ~
cd ~


# Check we have sudo
if [[ -z `which sudo` ]]; then
  echo "Install sudo first!"
  exit
fi


# Perform an update
sudo pacman -Syu


# Base setup
sudo pacman -S --needed ${cpackages[@]}


# Pull my dotfiles repository
if [[ ! -d "$HOME/dots" ]]; then
  echo "Cloning dotfiles repo..."
  git clone https://github.com/vixus0/dotfiles.git dots >/dev/null
fi


# Install package-query and yaourt
if [[ -z `pacman -Q yaourt` ]]; then
  pushd $HOME/dots/abs/package-query
  makepkg --syncdeps --clean
  sudo makepkg --install
  popd

  pushd $HOME/dots/abs/yaourt
  makepkg --syncdeps --clean
  sudo makepkg --install
  popd
fi


# Install configs for aforementioned packages
mkdir -p .config .local/{bin,include,lib,share/applications} .cache .ssh
stow -S cfg.{bash,git,ssh,tmux,vim} pkg.scripts


# Install GUI packages
if [[ $1 == "gui" ]]; then
  pushd $HOME/dots
  sudo pacman -S --needed "${xpackages[@]}"
  yaourt -S "${apackages[@]}"
  stow -S cfg.{herbstluftwm,xorg,pentadactyl,sxhkd,termite,conky}
  stow -S pkg.fonts
  popd

  pushd $HOME/dots/abs/lemonboy-bar-git
  makepkg --syncdeps --clean
  sudo makepkg --install
  popd
fi


